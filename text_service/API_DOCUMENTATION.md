# Text Service API Documentation

## –û–±–∑–æ—Ä

Text Service - —ç—Ç–æ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º AI –º–æ–¥–µ–ª–µ–π (OpenAI GPT –∏ –ª–æ–∫–∞–ª—å–Ω—ã–µ Gemma –º–æ–¥–µ–ª–∏ —á–µ—Ä–µ–∑ Ollama).

---

## üì• –¢–æ—á–∫–∏ –≤—Ö–æ–¥–∞ (HTTP API)

| Endpoint | –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ | –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ | –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ | –°—Ç–∞—Ç—É—Å –∫–æ–¥—ã |
|----------|-------|----------|----------------|---------------|-------------|
| `/` | GET | Health check | –ù–µ—Ç | `{"status": "online", "service": "Text Service", "version": "1.0.0"}` | 200 |
| `/health` | GET | –î–µ—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ | –ù–µ—Ç | `{"status": "healthy", "service": "Text Service", "version": "1.0.0"}` | 200 |
| `/generateText` | POST | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ | `TextGenerationRequest` | `TextGenerationResponse` | 200, 400, 500 |

---

## üì§ –¢–æ—á–∫–∏ –≤—ã—Ö–æ–¥–∞ (External APIs)

| –°–µ—Ä–≤–∏—Å | URL | –ü—Ä–æ–≤–∞–π–¥–µ—Ä | –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –§–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞ |
|--------|-----|-----------|---------------|------------|----------------|
| **OpenAI API** | `https://api.openai.com/v1/chat/completions` | `OpenAIProvider` | Bearer Token | GPT –º–æ–¥–µ–ª–∏ | JSON —Å `model`, `messages`, `tools` |
| **Ollama API** | `http://localhost:11434/api/generate` | `GemmaProvider` | –ù–µ—Ç | –õ–æ–∫–∞–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏ | JSON —Å `model`, `prompt`, `options` |
| **Ollama Health** | `http://localhost:11434/api/tags` | `GemmaProvider` | –ù–µ—Ç | –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ | GET –∑–∞–ø—Ä–æ—Å |

---

## üîß –í—Ö–æ–¥–Ω—ã–µ –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

### TextGenerationRequest

| –ü–æ–ª–µ | –¢–∏–ø | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|--------------|----------------------|----------|
| `prompt` | `str` | ‚úÖ | - | –¢–µ–∫—Å—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ |
| `functions` | `List[Function]` | ‚ùå | `[]` | –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π |
| `max_tokens` | `int` | ‚ùå | `300` | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤ |
| `model` | `str` | ‚ùå | `"openai"` | –ú–æ–¥–µ–ª—å –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è |
| `temperature` | `float` | ‚ùå | `0.8` | –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ |
| `system_prompt` | `str` | ‚ùå | `None` | –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç |
| `mock` | `bool` | ‚ùå | `False` | –†–µ–∂–∏–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è |

### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:
```json
{
  "prompt": "–°–æ–∑–¥–∞–π —Å—Ü–µ–Ω–∞—Ä–∏–π –¥–ª—è –∫–æ—Ä–æ—Ç–∫–æ–≥–æ –≤–∏–¥–µ–æ –æ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è—Ö",
  "functions": [
    {
      "type": "function",
      "function": {
        "name": "create_scenes",
        "description": "–°–æ–∑–¥–∞–Ω–∏–µ —Å—Ü–µ–Ω –¥–ª—è –≤–∏–¥–µ–æ",
        "parameters": {
          "type": "object",
          "properties": {
            "scenes": {
              "type": "array",
              "items": {"type": "string"}
            }
          }
        }
      }
    }
  ],
  "max_tokens": 500,
  "model": "openai",
  "temperature": 0.7,
  "system_prompt": "–¢—ã —ç–∫—Å–ø–µ—Ä—Ç –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –∫–æ—Ä–æ—Ç–∫–∏—Ö –≤–∏–¥–µ–æ –¥–ª—è —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç–µ–π"
}
```

---

## üìä –í—ã—Ö–æ–¥–Ω—ã–µ –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

### TextGenerationResponse

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `content` | `str \| Dict[str, Any]` | –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –∏–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü–∏–∏ |
| `success` | `bool` | –°—Ç–∞—Ç—É—Å —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è |
| `model_used` | `str` | –ù–∞–∑–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ |
| `tokens_generated` | `int` | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤ |

### HealthResponse

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `status` | `str` | –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞ ("online", "healthy") |
| `service` | `str` | –ù–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ |
| `version` | `str` | –í–µ—Ä—Å–∏—è —Å–µ—Ä–≤–∏—Å–∞ |

### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
```json
{
  "content": {
    "scenes": [
      "–í–æ—Å—Ö–æ–¥ —Å–æ–ª–Ω—Ü–∞ –Ω–∞–¥ –≥–æ—Ä–∞–º–∏",
      "–ü—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫ —Å —Ä—é–∫–∑–∞–∫–æ–º –Ω–∞ —Ç—Ä–æ–ø–µ",
      "–ö—Ä–∞—Å–∏–≤—ã–π –ø–µ–π–∑–∞–∂ —Å –æ–∑–µ—Ä–æ–º"
    ]
  },
  "success": true,
  "model_used": "gpt-4o-mini",
  "tokens_generated": 45
}
```

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –¢–∏–ø | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|-----|----------------------|----------|
| `OPENAI_API_KEY` | `str` | `None` | API –∫–ª—é—á OpenAI |
| `DEFAULT_OPENAI_MODEL` | `str` | `"gpt-4o-mini"` | –ú–æ–¥–µ–ª—å OpenAI –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é |
| `DEFAULT_MAX_TOKENS` | `int` | `300` | –ú–∞–∫—Å–∏–º—É–º —Ç–æ–∫–µ–Ω–æ–≤ |
| `DEFAULT_TEMPERATURE` | `float` | `0.8` | –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ |
| `LOCAL_TEXT_TO_TEXT_MODEL` | `str` | `"gemma2:2b"` | –õ–æ–∫–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å |
| `LOCAL_MODEL_URL` | `str` | `"http://localhost:11434/api/generate"` | URL –ª–æ–∫–∞–ª—å–Ω–æ–π –º–æ–¥–µ–ª–∏ |
| `SERVICE_HOST` | `str` | `"0.0.0.0"` | –•–æ—Å—Ç —Å–µ—Ä–≤–∏—Å–∞ |
| `SERVICE_PORT` | `int` | `8002` | –ü–æ—Ä—Ç —Å–µ—Ä–≤–∏—Å–∞ |
| `LOG_LEVEL` | `str` | `"INFO"` | –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è |

---

## üö¶ –ö–æ–¥—ã –æ—Ç–≤–µ—Ç–æ–≤ –∏ –æ—à–∏–±–∫–∏

| HTTP Code | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏—á–∏–Ω–∞ | –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ |
|-----------|--------|---------|---------------|
| **200** | Success | –£—Å–ø–µ—à–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ | –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è –º–æ–¥–µ–ª—å –æ—Ç–≤–µ—Ç–∞ |
| **400** | Bad Request | –ù–µ–≤–µ—Ä–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ | `{"detail": "error message", "status_code": 400}` |
| **500** | Internal Error | –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞/–º–æ–¥–µ–ª–∏ | `{"detail": "error message", "status_code": 500}` |
| **503** | Service Unavailable | –ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –≤–Ω–µ—à–Ω–∏—Ö API | `{"detail": "error message", "status_code": 503}` |

---

## üîÑ –¢–∏–ø—ã –∏—Å–∫–ª—é—á–µ–Ω–∏–π

| –ò—Å–∫–ª—é—á–µ–Ω–∏–µ | –ù–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç | –û–ø–∏—Å–∞–Ω–∏–µ | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ |
|------------|---------------|----------|---------------|
| `ModelException` | `Exception` | –ë–∞–∑–æ–≤–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ | –û–±—â–∏–µ –æ—à–∏–±–∫–∏ —Ä–∞–±–æ—Ç—ã —Å –º–æ–¥–µ–ª—è–º–∏ |
| `OpenAIException` | `ModelException` | –û—à–∏–±–∫–∏ OpenAI API | –ü—Ä–æ–±–ª–µ–º—ã —Å OpenAI —Å–µ—Ä–≤–∏—Å–æ–º |
| `GemmaException` | `ModelException` | –û—à–∏–±–∫–∏ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π | –ü—Ä–æ–±–ª–µ–º—ã —Å Ollama/Gemma |

---

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

| –¢–∏–ø –≤—ã–≤–æ–¥–∞ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –§–æ—Ä–º–∞—Ç | –ö–æ–¥–∏—Ä–æ–≤–∫–∞ |
|------------|------------|--------|-----------|
| **Console** | –í—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å | `%(asctime)s [%(levelname)s] %(name)s: %(message)s` | UTF-8 |
| **File** | `text_service.log` | `%(asctime)s [%(levelname)s] %(name)s: %(message)s` | UTF-8 |

### –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:
- **INFO**: –û—Å–Ω–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- **DEBUG**: –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–ø—Ä–æ—Å–∞—Ö/–æ—Ç–≤–µ—Ç–∞—Ö  
- **WARNING**: –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∏ –Ω–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏
- **ERROR**: –û—à–∏–±–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

---

## üöÄ –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞

### –ß–µ—Ä–µ–∑ Docker:
```bash
docker build -t text-service .
docker run -p 8002:8002 -e OPENAI_API_KEY=your_key text-service
```

### –õ–æ–∫–∞–ª—å–Ω–æ:
```bash
pip install -r requirements.txt
python app.py
```

### –ß–µ—Ä–µ–∑ Docker Compose:
```bash
docker-compose up text_service
```

---

## üß™ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ë–∞–∑–æ–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞:
```bash
curl -X POST "http://localhost:8002/generate" \
  -H "Content-Type: application/json" \
  -d '{
    "prompt": "–ù–∞–ø–∏—à–∏ –∫–æ—Ä–æ—Ç–∫–∏–π —Ä–∞—Å—Å–∫–∞–∑ –æ —Ä–æ–±–æ—Ç–µ",
    "max_tokens": 200,
    "temperature": 0.7
  }'
```

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏:
```bash
curl -X POST "http://localhost:8002/generate" \
  -H "Content-Type: application/json" \
  -d '{
    "prompt": "–°–æ–∑–¥–∞–π 3 —Å—Ü–µ–Ω—ã –¥–ª—è –≤–∏–¥–µ–æ –æ –∫—É–ª–∏–Ω–∞—Ä–∏–∏",
    "functions": [
      {
        "type": "function", 
        "function": {
          "name": "create_video_scenes",
          "description": "–°–æ–∑–¥–∞–Ω–∏–µ —Å—Ü–µ–Ω –¥–ª—è –≤–∏–¥–µ–æ",
          "parameters": {
            "type": "object",
            "properties": {
              "scenes": {
                "type": "array",
                "items": {"type": "string"}
              }
            }
          }
        }
      }
    ]
  }'
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è:
```bash
curl -X GET "http://localhost:8002/health"
```

---

## üìã –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   HTTP Client   ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   Text Service   ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  OpenAI API     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ   (FastAPI)      ‚îÇ    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚îÇ                  ‚îÇ    
                       ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                       ‚îÇ  ‚îÇ  Routes     ‚îÇ ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  Ollama API     ‚îÇ
                       ‚îÇ  ‚îÇ  Service    ‚îÇ ‚îÇ    ‚îÇ  (Local)        ‚îÇ
                       ‚îÇ  ‚îÇ  Providers  ‚îÇ ‚îÇ    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
                       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

- **–ü–æ—Ä—Ç**: 8002
- **Health Check**: `GET /health`
- **API Docs**: `GET /docs` (Swagger UI)
- **–õ–æ–≥–∏**: `text_service.log`

---

*–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞: 23 –∏—é–Ω—è 2025*
